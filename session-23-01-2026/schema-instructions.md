# Script Schema — Canonical Contract

**Project:** EditorBot
**Status:** LOCKED
**Layer:** Narrative → Production Boundary
**Consumes:** TemplateSpec, Beat Library
**Produces:** Render Plan (later)

---

## 1. Purpose of the Script Schema

The Script Schema exists to:

* freeze creative output into a **machine-safe artifact**
* guarantee compatibility with templates
* allow validation, retries, and repair
* drive **video assembly deterministically**

> If something is not representable in this schema, it cannot be rendered.

---

## 2. Script Object (Top-Level)

```json
{
  "script_id": "uuid",
  "language": "es",
  "dialect": "neutral",
  "template_id": "opinion_monologue_reel",
  "structure_type": "linear_argument",
  "total_duration_seconds": 52,
  "beats": [],
  "metadata": {}
}
```

### Required Fields

| Field                    | Description               |
| ------------------------ | ------------------------- |
| `script_id`              | UUID generated by backend |
| `language`               | Output language           |
| `dialect`                | Dialect after mediation   |
| `template_id`            | Selected template         |
| `structure_type`         | Narrative structure       |
| `total_duration_seconds` | Sum of beat durations     |
| `beats`                  | Ordered beat list         |

---

## 3. Beat Object (Core Unit)

```json
{
  "beat_id": "uuid",
  "role": "hook",
  "text": "¿Alguna vez te preguntaste…?",
  "estimated_duration_seconds": 6,
  "pace": "fast",
  "intensity": "high",
  "visual_affinity": "text_overlay"
}
```

### Required Fields

| Field                        | Description             |        |       |
| ---------------------------- | ----------------------- | ------ | ----- |
| `beat_id`                    | UUID                    |        |       |
| `role`                       | From Beat Library       |        |       |
| `text`                       | Spoken or narrated text |        |       |
| `estimated_duration_seconds` | Integer                 |        |       |
| `pace`                       | `slow                   | medium | fast` |

### Optional (Future-Safe)

| Field             | Purpose         |
| ----------------- | --------------- |
| `intensity`       | Emotional force |
| `visual_affinity` | Rendering hint  |

---

## 4. Metadata Block (Control Layer)

```json
"metadata": {
  "llm_model": "gemini-2.0-flash",
  "generation_mode": "constrained",
  "retry_count": 1,
  "validation": {
    "passed": true,
    "warnings": []
  }
}
```

This block is **never user-facing**.

It exists for:

* observability
* debugging
* internal learning loops

---

## 5. Structural Rules (Enforced)

### 5.1 Duration

```text
sum(beats[].estimated_duration_seconds)
== total_duration_seconds
```

Must also satisfy TemplateSpec limits.

---

### 5.2 Beat Order

* Beats must follow logical narrative order
* Required beats must appear **at least once**
* Forbidden beats must appear **zero times**

---

### 5.3 Beat Count

Validated against:

```json
template.script_structure.min_beats
template.script_structure.max_beats
```

---

## 6. Example — Opinion Reel Script

```json
{
  "script_id": "8d1f…",
  "language": "es",
  "dialect": "neutral",
  "template_id": "opinion_monologue_reel",
  "structure_type": "linear_argument",
  "total_duration_seconds": 48,
  "beats": [
    {
      "beat_id": "b1",
      "role": "hook",
      "text": "Nadie te explica por qué esto importa.",
      "estimated_duration_seconds": 6,
      "pace": "fast",
      "intensity": "high"
    },
    {
      "beat_id": "b2",
      "role": "argument",
      "text": "El problema no es la tecnología, es cómo decidimos usarla.",
      "estimated_duration_seconds": 30,
      "pace": "medium"
    },
    {
      "beat_id": "b3",
      "role": "conclusion",
      "text": "Y eso es algo que todavía podemos cambiar.",
      "estimated_duration_seconds": 12,
      "pace": "slow"
    }
  ],
  "metadata": {
    "generation_mode": "constrained",
    "validation": {
      "passed": true,
      "warnings": []
    }
  }
}
```

---

## 7. Relationship to Templates (Critical)

Templates:

* **constrain** script generation
* **do not modify** scripts after generation

The script is **guaranteed compatible** by construction.

No post-validation rejections.

---

## 8. Relationship to Rendering (Next Layer)

This schema feeds directly into:

* subtitle timing
* scene estimation
* audio alignment
* FFmpeg timelines
* MoviePy composition

No inference required downstream.

---

## 9. Design Principle (Non-Negotiable)

> The script is not text.
> The script is a plan.

Once this schema exists:

* creativity is upstream
* production is deterministic
* failures are debuggable
